<script>
$(function() {
  $('.carousel').carousel(); //initialize the carousel
  
  $('#reg-form').validate({ //initialize the form validator
    errorPlacement: function(error, element) {
      $('.active .validation_error').html(error);
    },
    rules: { //TODO add validation for email address
      'patient_enrollment[login]': {
        required: true,
        email: true
      },
      'patient_enrollment[login_confirmation]' : {
        equalTo: '#patient_enrollment_login' }
    },
    messages: {
      'patient_enrollment[login]': 'Enter a valid email.',
      'patient_enrollment[login_confirmation]': 'Your Emails do not match.'
    },
    invalidHandler: function() {
      $('.active .validation_error').removeClass('invisible');
      $('.active .registration-input, .active label').addClass('invalid');
    }
  })
  
  // custom validation for our password rules
  $.validator.addMethod("pwcheck", function(value) { 
    return  /[a-z]/.test(value) // has a lowercase letter
      && /[A-Z]/.test(value) // has an uppercase letter
      && /\d/.test(value) // has a digit
      && !(/(  )/.test(value)) //doesn't have consecutive whitespace
      && (value.indexOf(' ') !== 0) //doesn't start with whitespace
      && (value.lastIndexOf(' ') !== value.length - 1) //doesn't end with whitespace
  });
  
  // custom validation for dropdown
  $.validator.addMethod("question_dd", function(value) {
    return $('#patient_enrollment_security_question').val() !== '';
  });
  
  $('#next-button').on('click', nextButtonClick);

  $('#agree-button').on('click', nextButtonClick);

  $('.back_arrow').on('click', backClick);
  
  $('#patient_enrollment_answer').on('keyup', answerKeyup);
  
  $('#patient_enrollment_security_question').on('change', questionChange);
});
</script>

<div class="header">
  <a class="back_arrow" />
</div>
<div class="progress">
  <div class="progress-bar progress-bar-default" />
  <div class="progress-bar progress-bar-incomplete" />
  <div class="progress-bar progress-bar-incomplete" />
  <div class="progress-bar progress-bar-incomplete" />
</div>
  <form id="reg-form" method="post" novalidate="novalidate">
    <div class="carousel slide" id="registration-details">
      <div class="carousel-inner" role="listbox">
        <div class="item" id="tou_dpn_agreement">
          <div class="validation_error" style="display: none"/>
        </div>
        <div class="item" id="email">
          <div class="validation_error" style="display: none"/>
        </div>
        <div class="item" id="password">
          <div class="validation_error" style="display: none"/>
        </div>
        <div class="item" id="security_question">
          <select class="form-control" id="patient_enrollment_security_question" name="patient_enrollment[security_question]"><option value="">Security Question</option>
                          <option value="What&#39;s the worst band in the world?">What&#39;s the worst band in the world?</option></select>
                          <input class="registration-input" id="patient_enrollment_answer" name="patient_enrollment[answer]" placeholder="Enter your response to the question" type="text" />
          <div class="validation_error" style="display: none"/>
        </div>
      </div>
    </div>
    <div class="next">
      <a class="btn btn-primary" id="agree-button" href="#registration-details" role="button">I agree</a>
      <a class="btn btn-primary hidden" id="next-button" href="#registration-details" role="button">Next</a>
      <div class="submit" id="submit-button">
        <input class="btn btn-primary hidden" disabled="disabled" id="create-account" name="commit" type="submit" value="Create account" />
      </div>
    </div>
  </form>
